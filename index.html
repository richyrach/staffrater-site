<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Staff Rater — Rate. Support. Grow.</title>
  <link rel="icon" href="/staff-rater-icon.png">

  <!-- Canonical host lock (same as dashboard) -->
  <script>
  (function(){
    var wanted="www.staffrater.xyz";
    if(location.host!==wanted){
      location.replace("https://"+wanted+location.pathname+location.search+location.hash);
    }
  })();
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    html, body { background: #070b14; }
    .tile { transition: transform .25s ease, box-shadow .25s ease; }
    .tile:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,.35); }
    .menu { box-shadow: 0 12px 30px rgba(0,0,0,.35); }
  </style>
</head>
<body class="text-white font-sans antialiased">
  <!-- HEADER -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-[#070b14]/50 bg-[#070b14]/80 border-b border-white/5">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3">
        <img src="/staff-rater-icon.png" class="w-8 h-8 rounded-xl ring-1 ring-white/10" alt="">
        <span class="text-white/90 font-semibold">Staff Rater</span>
      </a>

      <!-- Right: auth/profile -->
      <div id="auth-area" class="flex items-center gap-3">
        <!-- Filled by JS using /api/me like your dashboard -->
        <a href="/api/login?return=/dashboard/index.html" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 ring-1 ring-white/10">Sign in with Discord</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <main>
    <section class="max-w-6xl mx-auto px-4 pt-10 pb-8">
      <div class="grid md:grid-cols-2 gap-8 items-center">
        <div>
          <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight">Rate. Support. Grow.</h1>
          <p class="mt-3 text-white/80 max-w-prose">Run a professional community with staff ratings, tickets, applications, polls and a clean dashboard integrated with Discord.</p>
          <div class="mt-6 flex flex-wrap gap-3">
            <a href="/dashboard" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-indigo-500 hover:bg-indigo-600">Open Dashboard</a>
            <a id="invite-btn" href="https://discord.com/oauth2/authorize?client_id=1410293903630012508&permissions=8&integration_type=0&scope=bot+applications.commands" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 ring-1 ring-white/10">Add to Discord</a>
            <a href="https://discord.gg/BR7zmffNFC" target="_blank" rel="noopener" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 ring-1 ring-white/10">Support server</a>
          </div>
        </div>
        <div class="grid sm:grid-cols-2 gap-4">
          <a class="tile block rounded-2xl bg-white/5 ring-1 ring-white/10 p-5" href="/docs">
            <div class="font-semibold">Quick start</div>
            <p class="text-white/70 text-sm mt-1">Invite the bot, configure staff, post rating UI, export CSV.</p>
          </a>
          <a class="tile block rounded-2xl bg-white/5 ring-1 ring-white/10 p-5" href="/profile">
            <div class="font-semibold">Public Profiles</div>
            <p class="text-white/70 text-sm mt-1">Clean, shareable profiles powered by real reviews.</p>
          </a>
          <a class="tile block rounded-2xl bg-white/5 ring-1 ring-white/10 p-5" href="/dashboard">
            <div class="font-semibold">Tickets</div>
            <p class="text-white/70 text-sm mt-1">Open/claim/close with logs and role access.</p>
          </a>
          <a class="tile block rounded-2xl bg-white/5 ring-1 ring-white/10 p-5" href="/dashboard">
            <div class="font-semibold">Applications & Polls</div>
            <p class="text-white/70 text-sm mt-1">Interactive forms and instant poll results.</p>
          </a>
        </div>
      </div>
    </section>

    <!-- Simple feature list (no heavy animations) -->
    <section class="max-w-6xl mx-auto px-4 pb-12">
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
        <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-5">
          <div class="font-semibold">Fair staff ratings</div>
          <p class="text-white/70 text-sm mt-1">DM notifications, result channel posts, edit/delete by rater.</p>
        </div>
        <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-5">
          <div class="font-semibold">CSV export</div>
          <p class="text-white/70 text-sm mt-1">One-click export for audits and analysis.</p>
        </div>
        <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-5">
          <div class="font-semibold">Owner tools</div>
          <p class="text-white/70 text-sm mt-1">Quiet owner-only commands and live command log.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-white/5">
    <div class="max-w-6xl mx-auto px-4 py-8 flex items-center justify-between flex-wrap gap-3 text-white/70">
      <div>© <span id="year"></span> Staff Rater</div>
      <nav class="flex items-center gap-4">
        <a href="/privacy" class="hover:text-white">Privacy</a>
        <a href="/terms" class="hover:text-white">Terms</a>
        <a href="/status" class="hover:text-white">Status</a>
      </nav>
    </div>
  </footer>

  <script>
  (function(){
    // 1) Capture token from HASH/QUERY, save, clean (same approach as dashboard)
    (function captureToken() {
      try {
        var t=null;
        if (location.hash) {
          var m = location.hash.match(/(?:^|[&#])token=([^&#]+)/);
          if (m) t = decodeURIComponent(m[1]);
        }
        if (!t && location.search) {
          var m2 = location.search.match(/(?:\?|&)token=([^&#]+)/);
          if (m2) t = decodeURIComponent(m2[1]);
        }
        if (t) {
          sessionStorage.setItem('sr_token', t);
          var clean = location.origin + location.pathname + location.search.replace(/([?&])token=[^&#]+(&|$)/, function(_,a,b){return a==='?'&&b?'?':''}) + (location.hash.replace(/(#|&)token=[^&#]+/,'')||'');
          history.replaceState(null,'', clean);
        }
      } catch(e){}
    })();

    // 2) Patch fetch for /api/* with Bearer like dashboard
    (function patchFetch(){
      var orig = window.fetch;
      window.fetch = function(input, init){
        try{
          var url = (typeof input==='string')?input:input.url;
          if (url && url.indexOf('http')!==0 && url.startsWith('/api/')){
            init = init || {};
            var h = new Headers(init.headers || {});
            var tok = sessionStorage.getItem('sr_token');
            if (tok) h.set('Authorization','Bearer '+tok);
            init.headers = h;
            if (!('credentials' in init)) init.credentials='omit';
            if (!('cache' in init)) init.cache='no-store';
            return orig(url, init);
          }
        }catch(e){}
        return orig(input, init);
      };
    })();

    // 3) Hydrate header profile menu from /api/me
    (async function hydrateHeader(){
      var auth=document.getElementById('auth-area');
      var me=null;
      try {
        var r=await fetch('/api/me');
        me = r.ok ? await r.json() : null;
      } catch(e){}

      if (!me || !me.ok) {
        auth.innerHTML = '<a href="/api/login?return=/dashboard/index.html" class="inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-white/10 hover:bg-white/15 ring-1 ring-white/10">Sign in with Discord</a>';
        return;
      }

      var u = me.session.user;
      var avatar = u.avatar ? ('https://cdn.discordapp.com/avatars/'+u.id+'/'+u.avatar+'.png?size=64') : 'https://cdn.discordapp.com/embed/avatars/0.png';

      auth.innerHTML = `
        <div class="relative">
          <button id="userMenuButton" class="flex items-center gap-2 px-2 py-1 rounded-xl hover:bg-white/10">
            <img src="${avatar}" class="w-8 h-8 rounded-full ring-1 ring-white/10" alt="">
            <span class="hidden sm:block text-white/80 text-sm max-w-[140px] truncate">${u.username}</span>
            <svg class="w-4 h-4 text-white/60" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z" clip-rule="evenodd"/></svg>
          </button>
          <div id="userMenu" class="menu hidden absolute right-0 mt-2 w-48 rounded-xl bg-[#0b1120] ring-1 ring-white/10">
            <a href="/dashboard" class="block px-4 py-2 hover:bg-white/10">Dashboard</a>
            <a href="/profile" class="block px-4 py-2 hover:bg-white/10">Profile</a>
            <hr class="border-white/10">
            <a href="/api/logout?redirect=/" class="block px-4 py-2 hover:bg-white/10">Log out</a>
          </div>
        </div>`;

      // dropdown logic
      var btn = document.getElementById('userMenuButton');
      var menu = document.getElementById('userMenu');
      function close(){ menu.classList.add('hidden'); }
      btn.addEventListener('click', function(e){ e.stopPropagation(); menu.classList.toggle('hidden'); });
      document.addEventListener('click', close);
      document.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
    })();

    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();
  })();
  </script>
</body>
</html>
